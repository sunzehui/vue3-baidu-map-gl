# useBrowserLocation <Badge type="tip" text="^0.0.33" />

用于获取用户所在的城市位置信息(根据浏览器原生定位或者结合安卓定位 SDK 辅助定位)，相比[Ip 定位](./useIpLocation)获取的信息更丰富，但稳定性并不高，有时候很精准，有时候飘半个中国。

```ts
import { useBrowserLocation } from 'vue3-baidu-map-gl'
```

:::warning 注意

1. 由于 Chrome、iOS10 以上系统等已不再支持非安全域的浏览器定位请求，为保证定位成功率和精度，请尽快升级您的站点到 HTTPS。
2. iOS15 系统浏览器默认关闭位置请求，需要用户设置手机为允许/询问后方可获取精确的定位,定位权限的开启方式请参见 iOS15 定位问题。
3. 由于浏览器原生定位成功率并不高，可以尝试 [Ip 定位](./useIpLocation) 和 [安卓 SDK 定位](https://lbsyun.baidu.com/index.php?title=android-locsdk/guide/addition-func/assistant-h5) 进行辅助，如果定位精准在城市级别，可联系百度地图提供 ak 以提高定位精准度。

:::

## 示例

<div>
  <Map enableScrollWheelZoom ref="map" @initd="get" :center="location.point || undefined">
    <template v-if="!isLoading">
      <Marker :position="location.point"></Marker>
      <Circle strokeStyle="solid" strokeColor="#0099ff" :strokeOpacity="0.8" fillColor="#0099ff"  :fillOpacity="0.5" :center="location.point" :radius="location.accuracy" />
    </template>
  </Map>

  <div class="state" v-if="!isLoading && !isError">
    <h5>定位:</h5>
    <span>城市 - {{ location.address?.province }}-{{ location.address?.city }}-{{ location.address?.district }}-{{ location.address?.street }}</span>
    <span>纬度 - {{ location.point?.lat }}</span>
    <span>经度 - {{ location.point?.lng }}</span>
    <br />
    <span>定位精度 - {{ location.accuracy }}m</span>
  </div>
  <div class="state"  v-else-if="isError">
    出错了，{{ status }}
  </div>
  <div class="state" v-else>
    定位中...
  </div>
  <button v-if="!isLoading" class="myButton" @click="get">重新获取</button>
</div>

<script lang="ts" setup>
  import {  ref  } from 'vue-demi'
  import { useBrowserLocation } from 'vue3-baidu-map-gl'
  const map = ref()
  const { get, location, isLoading, isError, status } = useBrowserLocation(null, () => {
    map.value.resetCenter()
  })
</script>

<style>
  .state {
    margin-top: 15px;
  }
  .state span {
    margin-right: 25px;
  }
</style>

:::details 点击查看代码

<!-- prettier-ignore -->
```html
<div>
  <Map enableScrollWheelZoom ref="map" @initd="get" :center="location.point || undefined">
    <template v-if="!isLoading">
      <Marker :position="location.point"></Marker>
      <Circle
        stroke-style="solid"
        strokeColor="#0099ff"
        :strokeOpacity="0.8"
        fillColor="#0099ff"
        :fillOpacity="0.5"
        :center="location.point"
        :radius="location.accuracy"
      />
    </template>
  </Map>

  <div class="state" v-if="!isLoading && !isError">
    <h5>定位:</h5>
    <span>
      城市 - {{ location.address?.province }}-{{ location.address?.city }}-{{ location.address?.district }}-{{
      location.address?.street }}
    </span>
    <span>纬度 - {{ location.point?.lat }}</span>
    <span>经度 - {{ location.point?.lng }}</span>
    <br />
    <span>定位精度 - {{ location.accuracy }}m</span>
  </div>
  <div class="state" v-else-if="isError">出错了，{{ status }}</div>
  <div class="state" v-else>定位中...</div>
  <button v-if="!isLoading" @click="get">重新获取</button>
</div>

<script lang="ts" setup>
  import {  ref  } from 'vue-demi'
  import { useBrowserLocation, Marker, Circle } from 'vue3-baidu-map-gl'
  const map = ref()
  const { get, location, isLoading, isError, status } = useBrowserLocation(null, () => {
    map.value.resetCenter()
  })
</script>

<style>
  .state {
    margin-top: 15px;
  }
  .state span {
    margin-right: 25px;
  }
</style>
```

:::

## 用法

```ts
const { get, location, isLoading, isError, status } = useBrowserLocation(options, cal)
```

:::tip
该 hooks 依赖于 `BMapGL` ，所以需要在 `Map` 组件初始化完毕调用 `get` 方法后数据才可用
:::

### 参数

| 参数    | 描述                 | 类型                                                      | 默认值 |
| ------- | -------------------- | --------------------------------------------------------- | ------ |
| options | 浏览器定位配置项     | [`UseBrowserLocationOptions`](#usebrowserlocationoptions) | -      |
| cal     | 定位成功后的回调函数 | `(location: Ref<Location>) => void`                       | -      |

#### UseBrowserLocationOptions

| 属性               | 描述                                                                                                                                                     | 类型      | 默认值    |
| ------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | --------- |
| enableSDKLocation  | 是否启用安卓定位 SDK 辅助定位，适用于安卓 WebView 页面，[详见](https://lbsyun.baidu.com/index.php?title=android-locsdk/guide/addition-func/assistant-h5) | `boolean` | `false`   |
| enableHighAccuracy | 是否要求浏览器获取最佳效果，同[浏览器定位](https://developer.mozilla.org/zh-CN/docs/Web/API/Geolocation/getCurrentPosition)接口参数                      | `boolean` | `false`   |
| timeout            | 超时时间                                                                                                                                                 | `number`  | `10000`   |
| maximumAge         | 允许返回指定事件内的缓存结果，单位为毫秒。如果为`0`，则每次请求都获取最新的定位结果。默认为`10`分钟                                                      | `number`  | `600,000` |

### 引用

| 引用      | 描述                                                   | 类型                    |
| --------- | ------------------------------------------------------ | ----------------------- |
| isLoading | 是否在获取中                                           | `boolean`               |
| location  | 定位信息                                               | [`Location`](#location) |
| get       | 获取定位方法，需要在`Map`组件`initd`事件触发后才可调用 | `() => void`            |
| isError   | 是否定位出错                                           | `boolean`               |
| status    | 定位状态                                               | [`Status`](#status)     |

#### Location

| 属性     | 描述     | 类型                          |
| -------- | -------- | ----------------------------- |
| accuracy | 定位精度 | `number`                      |
| point    | 经纬度点 | `{ lng: number lat: number }` |
| address  | 定位地址 | [`Address`](#address)         |

#### Status

| status                   | 描述                 |
| ------------------------ | -------------------- |
| BMAP_STATUS_SUCCESS      | 定位成功             |
| ERR_POSITION_TIMEOUT     | 定位超时             |
| ERR_POSITION_UNAVAILABLE | 定位不可用           |
| ERR_PERMISSION_DENIED    | 没有权限，定位被拒绝 |

#### Address

| 属性          | 描述      | 类型     |
| ------------- | --------- | -------- |
| country       | 国家      | `string` |
| city          | 城市      | `string` |
| city_code     | 城市 code | `string` |
| district      | 行政区    | `string` |
| province      | 省份      | `string` |
| street        | 街道      | `string` |
| street_number | 城市 code | `string` |

## TS 类型定义参考

```ts
import {  Ref  } from 'vue-demi'
import { Point } from './usePoint'
interface UseBrowserLocationOptions {
  /**
   * 是否开启SDK辅助定位，仅当使用环境为移动web混合开发，且开启了定位sdk辅助定位功能后生效
   */
  enableSDKLocation?: boolean
  /**
   * 是否要求浏览器获取最佳效果，同浏览器定位接口参数。默认为false
   */
  enableHighAccuracy?: boolean
  /**
   * 超时事件，单位为毫秒。默认为10秒
   */
  timeout?: number
  /**
   * 允许返回指定事件内的缓存结果，单位为毫秒。如果为0，则每次请求都获取最新的定位结果。默认为10分钟
   */
  maximumAge?: number
  /**
   * 是否开启SDK辅助定位
   */
  SDKLocation?: boolean
}
declare type Status =
  | 'BMAP_STATUS_SUCCESS'
  | 'ERR_PERMISSION_DENIED'
  | 'ERR_POSITION_UNAVAILABLE'
  | 'ERR_POSITION_TIMEOUT'
interface Location {
  accuracy: number
  point: Point
  address: {
    country: string
    city: string
    city_code: string
    district: string
    province: string
    street: string
    street_number: string
  }
}
export declare function useBrowserLocation(
  options?: UseBrowserLocationOptions,
  cal?: (location: Ref<Location>) => void
): {
  get: () => void
  isLoading: Ref<boolean>
  isError: Ref<boolean>
  status: Ref<Status | undefined>
  location: Ref<Location>
}
```
